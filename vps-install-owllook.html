<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>VPS搭建owllook小说搜索引擎 | 康诺&#39;S 小屋</title>
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(https://cdn.free.gd/assets/img/header.7sna2ax20w.avif)">
        <div class='av-pic' style="background-image: url(https://cdn.free.gd/assets/img/avatar.26ljofvr7k.avif)">
        </div>
    </section>
    <section class='menu'>
        <div>康诺&#39;S 小屋</div>
        
            <div>一个中年大叔的日常记录</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>首页</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>归档</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>标签</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>分类</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a target="_blank" rel="noopener" href="https://github.com/ylqjgm">
                    <img src="/assets/github.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>VPS搭建owllook小说搜索引擎</h1>
    </header>

    <section>
      <h2 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h2><p>摘录自项目主页说明：</p>
<blockquote>
<p>owllook 是一个基于其他搜索引擎构建的垂直小说搜索引擎，owllook目的是让阅读更简单、优雅，让每位读者都有舒适的阅读体验，如搜书、阅读、收藏、追更、推荐等功能。</p>
</blockquote>
<blockquote>
<p>owllook 是一款使用 Python 编写的小说搜索引擎，无论结构以及用户体验来说都挺不错，系统使用 MongoDB 及 Redis 做数据存储，且附带众多规则，搭建后可迅速开设一个简单的小说搜索引擎。</p>
</blockquote>
<p>本次，将以 CentOS 作为基础系统，一步步搭建出一个简单的小说搜索引擎。</p>
<p>演示可观看：<del><a target="_blank" rel="noopener" href="https://read.free.gd/">https://read.free.gd</a></del></p>
<span id="more"></span>

<h2 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h2><p>由于程序依赖于 Python、MongoDB、Redis 等，在安装之前，我们需要先解决依赖环境！</p>
<p>因是在 Proxmox 中进行安装，所以 MongoDB 以及 Redis 都会存放在不同的 LXC 中，避免单机压力过大问题。</p>
<h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><p>在 Proxmox 中开设一台 LXC 小鸡，系统选择 Ubuntu，并配置网络 10.10.10.2，开启后进入控制台开始安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install wget -y</span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.16.tgz</span><br><span class="line">tar zxf mongodb-linux-x86_64-4.0.16.tgz</span><br><span class="line">mv mongodb-linux-x86_64-4.0.16 /usr/local/mongodb</span><br><span class="line">mkdir -p /var/lib/mongodb</span><br><span class="line">useradd -s /sbin/nologin mongod</span><br><span class="line">chown -R mongod:mongod /var/lib/mongodb</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/mongod.conf &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mongod.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> documentation of all options, see:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  http://docs.mongodb.org/manual/reference/configuration-options/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">where</span> to write logging data.</span></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: $&#123;mongo_data_dir&#125;/mongod.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Where and how to store data.</span></span><br><span class="line">storage:</span><br><span class="line">  dbPath: $&#123;mongo_data_dir&#125;</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> engine:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> mmapv1:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> wiredTiger:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">how the process runs</span></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod.pid</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">network interfaces</span></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: false</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">security:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> authorization: enabled</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">operationProfiling:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replication:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sharding:</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /lib/systemd/system/mongod.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=MongoDB Database Server</span><br><span class="line">After=multi-user.target</span><br><span class="line">Documentation=https://docs.mongodb.org/manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mongod</span><br><span class="line">Group=mongod</span><br><span class="line">Environment=&quot;OPTIONS=-f /etc/mongod.conf&quot;</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mongod</span><br><span class="line">ExecStart=/usr/local/mongodb/bin/mongod $OPTIONS</span><br><span class="line">ExecStartPre=/bin/mkdir -p /var/run/mongodb</span><br><span class="line">ExecStartPre=/bin/chown mongod:mongod /var/run/mongodb</span><br><span class="line">ExecStartPre=/bin/chmod 0755 /var/run/mongodb</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line">PIDFile=/var/run/mongodb/mongod.pid</span><br><span class="line">Type=forking</span><br><span class="line">LimitFSIZE=infinity</span><br><span class="line">LimitCPU=infinity</span><br><span class="line">LimitAS=infinity</span><br><span class="line">LimitNOFILE=64000</span><br><span class="line">LimitNPROC=64000</span><br><span class="line">LimitMEMLOCK=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">TasksAccounting=false</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable mongod.service</span><br><span class="line">systemctl start mongod.service</span><br></pre></td></tr></table></figure>

<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>在 Proxmox 中开设一台 Alpine 小鸡，配置网络 10.10.10.3，进入控制台执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apk update</span><br><span class="line">apk upgrade</span><br><span class="line">apk add redis</span><br><span class="line">rc-update add redis default</span><br><span class="line">service redis start</span><br></pre></td></tr></table></figure>

<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>最后再开启一台小鸡，这次选用 CentOS 操作系统，配置 IPv6 为 2606:4700:xxxx::xxxx，内网地址为 10.10.10.3，其实本次选择三个不同的系统，也只是想说明下，任何东西其实在不同的系统中都可以完成对应的操作，只是取决于是否适合而已。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install wget git curl screen bzip2</span><br><span class="line">wget https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</span><br><span class="line">chmod -R a+x Anaconda3-2019.10-Linux-x86_64.sh</span><br><span class="line">./Anaconda3-2019.10-Linux-x86_64.sh</span><br></pre></td></tr></table></figure>

<p>根据提示一次输入：Enter、yes、Enter</p>
<p>完成后刷新一次 Shell 并创建 Python 环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br><span class="line">conda create -n python36 python=3.6</span><br></pre></td></tr></table></figure>

<h3 id="owllook"><a href="#owllook" class="headerlink" title="owllook"></a>owllook</h3><p>继续在 CentOS 中执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/howie6879/owllook.git /root/owllook</span><br><span class="line">cd owllook</span><br><span class="line">pip install pipenv</span><br><span class="line">pipenv install --python ~/anaconda3/envs/python36/bin/python3.6</span><br></pre></td></tr></table></figure>

<p>若上面最后一条命令执行失败，请执行下面两条命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipenv run pip install pip==18.0</span><br><span class="line">pipenv install</span><br></pre></td></tr></table></figure>

<p>安装完成后，修改 &#x2F;root&#x2F;owllook&#x2F;owllook&#x2F;config&#x2F;config.py，将</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VAL_HOST = os.getenv(<span class="string">&#x27;VAL_HOST&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VAL_HOST = os.getenv(<span class="string">&#x27;VAL_HOST&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>同时查找所有涉及到 MongoDB 及 Redis 地址的文件，将其改为自己的 MongoDB 与 Redis 地址。</p>
<h3 id="开启反代"><a href="#开启反代" class="headerlink" title="开启反代"></a>开启反代</h3><p>在启动程序之前，咱们先安装一个 Nginx 对程序进行反代，否则每次访问都得加上端口号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nginx</span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>

<p>创建文件 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;owllook.conf</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span> read.free.gd;</span><br><span class="line">  </span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Forproxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto scheme;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Hosthttp_host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-NginX-Proxy <span class="literal">true</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://0.0.0.0:8001;</span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br><span class="line">cd /root/owllook</span><br><span class="line">pipenv run gunicorn -c owllook/config/gunicorn.py --worker-class sanic.worker.GunicornWorker owllook.server:app</span><br></pre></td></tr></table></figure>

<p>接着打开网站看看，已经成功可用了！</p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2020-11-29T06:09:41.000Z" itemprop="datePublished">
              2020-11-29
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/%E5%B0%8F%E8%AF%B4/">小说</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/owllook/">owllook</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2024 - 康诺 </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>