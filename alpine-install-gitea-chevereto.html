<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>在Alpine下安装Gitea与Chevereto | 康诺&#39;S 小屋</title>
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(https://coolbie.github.io/picx-images-hosting/assets/img/header.7sna2ax20w.avif)">
        <div class='av-pic' style="background-image: url(https://coolbie.github.io/picx-images-hosting/assets/img/avatar.26ljofvr7k.avif)">
        </div>
    </section>
    <section class='menu'>
        <div>康诺&#39;S 小屋</div>
        
            <div>一个中年大叔的日常记录</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>首页</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>归档</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>标签</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>分类</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a target="_blank" rel="noopener" href="https://github.com/ylqjgm">
                    <img src="/assets/github.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>在Alpine下安装Gitea与Chevereto</h1>
    </header>

    <section>
      <h2 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h2><p>前面的两篇文章里分别介绍了如何在 <a target="_blank" rel="noopener" href="https://www.hetzner.com/">Hetzner</a> 里安装 <a target="_blank" rel="noopener" href="https://proxmox.com/">Proxmox</a>，以及如何在 VPS 里使用 <a target="_blank" rel="noopener" href="https://openlitespeed.org/">OpenLiteSpeed</a> 搭建一个 <a target="_blank" rel="noopener" href="https://wordpress.com/">WordPress</a> 网站。</p>
<p><a href="http://free.gd/hetzner-proxmox-ipv6-vps.html">Hetzner服务器内安装Proxmox并开通IPv6小鸡</a></p>
<p><a href="http://free.gd/openlitespeed-create-wordpress-lscache.html">使用OpenLiteSpeed创建WordPress并开启缓存</a></p>
<p>如果一台独立服务器，仅仅用来搭建一个 WordPress，那显然是太浪费了，为了更大程度的利用咱们的服务器，于是我决定在上面再搭建两样东西，一个是 <a target="_blank" rel="noopener" href="https://gitea.com/">Gitea</a>，另一个是 <a target="_blank" rel="noopener" href="https://chevereto.com/">Chevereto</a>，这俩玩意儿分别是一个类似于 <a target="_blank" rel="noopener" href="https://github.com/">Github</a> 的代码管理平台，另一个是较多人使用的图床程序。</p>
<span id="more"></span>

<h2 id="Gitea"><a href="#Gitea" class="headerlink" title="Gitea"></a>Gitea</h2><p>Gitea 是一个功能与 Github 等类似，提供 <a target="_blank" rel="noopener" href="https://git-scm.com/">Git</a> 代码托管服务，程序使用 <a target="_blank" rel="noopener" href="https://go.dev/">Golang</a> 语言开发，是 <a target="_blank" rel="noopener" href="https://gogs.io/">Gogs</a> 的独立分支，而为何要单独开发分支的原因，在官方网站也有说明，感兴趣的可以看看。</p>
<p>其实 Gitea 与 Gogs 可以说非常相似，不过由于 Gogs 仅仅是个人作品，而 Gitea 是社区作品，所以这里可乐选择了使用 Gitea，若您喜欢 Gogs，其实也是一样的。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>首先咱们开通一台 <a target="_blank" rel="noopener" href="https://alpinelinux.org/">Alpine</a> 的 VPS，使用 Alpine 的原因就是它够轻便。</p>
<p>在 Alpine 中安装 Gitea 非常简单，只需要一条命令即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add gitea</span><br></pre></td></tr></table></figure>

<p>安装完成后启动程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service gitea start</span><br></pre></td></tr></table></figure>

<p>此时打开 <a target="_blank" rel="noopener" href="http://ip:3000/">http://ip:3000</a> ，一般会跳转到 Gitea 的安装页面，若没有跳转，请手动输入 <a target="_blank" rel="noopener" href="http://ip:3000/install">http://ip:3000/install</a> ，然后按照提示完成安装即可。</p>
<h3 id="反代"><a href="#反代" class="headerlink" title="反代"></a>反代</h3><p>此时，咱们的 Gitea 是可以正常运行的，但会发现访问地址是需要添加端口号 3000 的，这样非常不方便，为了能够正常访问，咱们添加一个用于反代 Gitea 的 Web 前端，这里选择了 <a target="_blank" rel="noopener" href="https://caddyserver.com/">Caddy</a>，原因同样是轻便。</p>
<p>同样一条命令安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add caddy</span><br></pre></td></tr></table></figure>

<p>接着修改默认配置文件 <strong>&#x2F;etc&#x2F;caddy&#x2F;caddyfile</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g.free.<span class="section">gd</span> &#123;</span><br><span class="line">    <span class="attribute">gzip</span></span><br><span class="line">    tls admin<span class="variable">@free</span>.gd</span><br><span class="line">    proxy / http://localhost:3000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存后启动程序，会自动配置 SSL</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service caddy start</span><br></pre></td></tr></table></figure>

<p>一切正常的话，使用 <a target="_blank" rel="noopener" href="https://git.free.gd/">https://git.free.gd</a> 再次访问，发现已经可以正常访问，咱们再添加下服务自启动即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rc-update add caddy default</span><br><span class="line">rc-update add gitea default</span><br></pre></td></tr></table></figure>

<h2 id="Chevereto"><a href="#Chevereto" class="headerlink" title="Chevereto"></a>Chevereto</h2><p>Chevereto 是一款基于 <a target="_blank" rel="noopener" href="https://www.php.net/">PHP</a> 语言开发的图片管理程序，程序功能强大，操作简单，深得众多网友喜欢，程序分为收费版与免费版，对于个人站长而言，免费版的功能是完全够用的，故此，本文中的 Chevereto 也一律代指免费版。</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>同样开启一台 Alpine 系统的 VPS，然后使用命令安装 PHP7 及 Caddy</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add caddy php7 php7-fpm</span><br></pre></td></tr></table></figure>

<p>然后根据搜索结果安装自己所需要的 PHP 扩展：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apk search php7</span><br><span class="line">apk add php7-curl php7-pdo_mysql *****</span><br></pre></td></tr></table></figure>

<p>安装完成后，咱们对 Caddy 进行配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">i.free.<span class="section">gd</span> &#123;</span><br><span class="line">    <span class="attribute">gzip</span></span><br><span class="line">    tls admin<span class="variable">@free</span>.gd</span><br><span class="line">    root /data/www</span><br><span class="line">    fastcgi / /data/run/php-fpm.sock php</span><br><span class="line">    log /data/log/access.log</span><br><span class="line">    errors /data/log/caddy.log</span><br><span class="line">    rewrite &#123;</span><br><span class="line">        <span class="section">to</span> &#123;path&#125; &#123;path&#125;/ /index.php?&#123;query&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再配置 <strong>&#x2F;etc&#x2F;php7&#x2F;php-fpm.conf</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">pid</span> = /data/run/php-fpm.pid</span><br><span class="line"><span class="attr">error_log</span> = /data/log/php-fpm.log</span><br><span class="line"><span class="attr">log_level</span> = warning</span><br><span class="line"></span><br><span class="line"><span class="attr">emergency_restart_threshold</span> = <span class="number">30</span></span><br><span class="line"><span class="attr">emergency_restart_interval</span> = <span class="number">60</span>s</span><br><span class="line"><span class="attr">process_control_timeout</span> = <span class="number">5</span>s</span><br><span class="line"><span class="attr">daemonize</span> = <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="section">[caddy]</span></span><br><span class="line"><span class="attr">listen</span> = /data/run/php-fpm.sock</span><br><span class="line"><span class="attr">listen.backlog</span> = -<span class="number">1</span></span><br><span class="line"><span class="attr">listen.allowed_clients</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">listen.owner</span> = caddy</span><br><span class="line"><span class="attr">listen.group</span> = caddy</span><br><span class="line"><span class="attr">listen.mode</span> = <span class="number">0666</span></span><br><span class="line"><span class="attr">user</span> = caddy</span><br><span class="line"><span class="attr">group</span> = caddy</span><br><span class="line"></span><br><span class="line"><span class="attr">pm</span> = dynamic</span><br><span class="line"><span class="attr">pm.max_children</span> = <span class="number">30</span></span><br><span class="line"><span class="attr">pm.start_servers</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">pm.min_spare_servers</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">pm.max_spare_servers</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">pm.max_requests</span> = <span class="number">2048</span></span><br><span class="line"><span class="attr">pm.process_idle_timeout</span> = <span class="number">10</span>s</span><br><span class="line"><span class="attr">request_terminate_timeout</span> = <span class="number">120</span></span><br><span class="line"><span class="attr">request_slowlog_timeout</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">slowlog</span> = /data/log/php-slow.log</span><br><span class="line"><span class="attr">rlimit_files</span> = <span class="number">51200</span></span><br><span class="line"><span class="attr">rlimit_core</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">catch_workers_output</span> = <span class="literal">yes</span></span><br><span class="line">env<span class="section">[PATH]</span> = /usr/local/bin:/usr/bin:/bin</span><br><span class="line">env<span class="section">[TMP]</span> = /tmp</span><br><span class="line">env<span class="section">[TMPDIR]</span> = /tmp</span><br><span class="line">env<span class="section">[TEMP]</span> = /tmp</span><br></pre></td></tr></table></figure>

<p>接着执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/www</span><br><span class="line">mkdir -p /data/run</span><br><span class="line">mkdir -p /data/log</span><br><span class="line">wget --no-check-certificate https://github.com/Chevereto/installer/raw/master/installer.php -O /data/www/installer.php</span><br><span class="line">chown -R caddy:caddy /data</span><br><span class="line">service php-fpm7 start</span><br><span class="line">service caddy start</span><br><span class="line">rc-update add php-fpm7 default</span><br><span class="line">rc-update add caddy default</span><br></pre></td></tr></table></figure>

<p>打开 <a target="_blank" rel="noopener" href="https://ip/installer.php">https://ip/installer.php</a> 出现安装界面，按照提示顺序安装即可。</p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2020-11-20T14:03:36.000Z" itemprop="datePublished">
              2020-11-20
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/Alpine/">Alpine</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Chevereto/">Chevereto</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Gitea/">Gitea</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2024 - 康诺 </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>